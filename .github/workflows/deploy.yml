name: Deploy
 
on:
  workflow_dispatch:
    inputs:
      DEPLOY_TARGET:
        required: true
        type: choice
        description: Container image to deploy
        options: 
        - production:server:runner
        - production:server:api
      IMAGE_VERSION:
        required: true
        type: string
        default: latest
      ENVIRONMENT:
        required: true
        type: choice
        description: Container image to deploy
        options: 
        - production

jobs:
  production-notification-hub-runner:
    uses: 7egend/workflows/.github/workflows/deploy.yml@main
    if: ${{ inputs.DEPLOY_TARGET == 'production:server:runner' }}
    with:
      DEPLOYER_IMAGE: ghcr.io/${{ github.repository }}/devops/ansible:${{ inputs.IMAGE_VERSION }}
      PLAYBOOK: playbooks/${{ inputs.ENVIRONMENT }}/notification-hub/deploy.yaml
      ENVIRONMENT: ${{ inputs.ENVIRONMENT }}
      KNOWN_HOSTS_FILE: ${{ vars.KNOWN_HOSTS_FILE }}
    secrets: inherit
    
  production-notification-hub-api:
    uses: 7egend/workflows/.github/workflows/deploy.yml@main
    if: ${{ inputs.DEPLOY_TARGET == 'production:server:api' }}
    with:
      DEPLOYER_IMAGE: ghcr.io/${{ github.repository }}/devops/ansible:${{ inputs.IMAGE_VERSION }}
      PLAYBOOK: playbooks/${{ inputs.ENVIRONMENT }}/notification-hub/deploy.yaml
      ENVIRONMENT: ${{ inputs.ENVIRONMENT }}
      KNOWN_HOSTS_FILE: ${{ vars.KNOWN_HOSTS_FILE }}
    secrets: inherit
