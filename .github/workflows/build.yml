name: Build container image

on:
  push:
  workflow_dispatch:
    inputs:
      PROJECT:
        description: 'Project to build'
        required: true
        type: choice
        options:
          - devops/ansible
          - server/runner
          - server/api

jobs:
  echo-vars:
    runs-on: ubuntu-latest
    steps:
      - name: Imprimir valor de github.event.changes
        run: echo "${{ github.event.changes }}"
  
  devops-ansible:
    if: ${{ inputs.PROJECT == 'devops/ansible' }}
    uses: 7egend/workflows/.github/workflows/build.yml@main
    permissions: write-all
    secrets: inherit
    with:
      DOCKERFILE_PATH: devops/ansible/Dockerfile
      CONTEXT_PATH: devops/ansible
      CONTAINER_RELEASE_VERSION: ${{ github.sha }}

  server-runner:
    if: ${{ || inputs.PROJECT == 'server/runner' }}
    uses: 7egend/workflows/.github/workflows/build.yml@main
    permissions: write-all
    secrets: inherit
    with:
      DOCKERFILE_PATH: server/runner/Dockerfile
      CONTEXT_PATH: server/runner
      CONTAINER_RELEASE_VERSION: ${{ github.sha }}
      
  server-api:
    if: ${{ inputs.PROJECT == 'server/api' }}
    uses: 7egend/workflows/.github/workflows/build.yml@main
    permissions: write-all
    secrets: inherit
    with:
      DOCKERFILE_PATH: server/api/Dockerfile
      CONTEXT_PATH: server/api
      CONTAINER_RELEASE_VERSION: ${{ github.sha }}
    
